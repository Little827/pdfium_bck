{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6315cf95_ce2cb0ab",
        "filename": "core/fxge/skia/fx_skia_device.cpp",
        "patchSetId": 15
      },
      "lineNbr": 2737,
      "author": {
        "id": 5045
      },
      "writtenOn": "2022-09-13T07:42:27Z",
      "side": 1,
      "message": "Instead of adding a new parameter, why not just adjust the `options` argument the callers pass in to properly set `sampling_options`?",
      "revId": "78bf67019f606612dee41b9f0d52389bdf383327",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2e98af16_df413437",
        "filename": "core/fxge/skia/fx_skia_device.cpp",
        "patchSetId": 15
      },
      "lineNbr": 2737,
      "author": {
        "id": 7620
      },
      "writtenOn": "2022-09-13T16:45:02Z",
      "side": 1,
      "message": "Do you mean adding an element to struct FXDIB_ResampleOptions?\n\nFXDIB_ResampleOptions is used by AGG, SkiaPaths and Skia and all of its attributes come from parsing the PDF. `optimize_sampling_option` is for Skia only and it does not directly come reading the PDF. This was a main reason that I added a new parameter for it.\n\nIf we want to move it into FXDIB_ResampleOptions, one way to do it is that we add `optimize_sampling_option` into FXDIB_ResampleOptions but keep it guarded by _SKIA_SUPPORT_. So that we can avoid adding unused attributes for AGG and SkiaPaths.\n\nWDYT?",
      "parentUuid": "6315cf95_ce2cb0ab",
      "revId": "78bf67019f606612dee41b9f0d52389bdf383327",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0ab807f_9b20d9cd",
        "filename": "core/fxge/skia/fx_skia_device.cpp",
        "patchSetId": 15
      },
      "lineNbr": 2737,
      "author": {
        "id": 5045
      },
      "writtenOn": "2022-09-13T20:41:47Z",
      "side": 1,
      "message": "But SetDIBits() calls StartDIBitsSkia() and its FXDIB_ResampleOptions is default-constructed. That FXDIB_ResampleOptions does not come from parsing the PDF. If values in that FXDIB_ResampleOptions changes, that\u0027s an implementation detail.\n\nFXDIB_ResampleOptions does not need an additional field. It just has to be set in a way that StartDIBitsSkia() will behave as desired. i.e. Turn the existing knobs already available to get to the desired state, instead of adding a new knob.",
      "parentUuid": "2e98af16_df413437",
      "revId": "78bf67019f606612dee41b9f0d52389bdf383327",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7d75fe4d_07e5287a",
        "filename": "core/fxge/skia/fx_skia_device.cpp",
        "patchSetId": 15
      },
      "lineNbr": 2779,
      "author": {
        "id": 5045
      },
      "writtenOn": "2022-09-13T07:42:27Z",
      "side": 1,
      "message": "I don\u0027t understand the calculations here. For instance, if `matrix` is the identity matrix, then the dest size is 1x1? This size result does not make sense to me.",
      "revId": "78bf67019f606612dee41b9f0d52389bdf383327",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "deff943c_87b005fe",
        "filename": "core/fxge/skia/fx_skia_device.cpp",
        "patchSetId": 15
      },
      "lineNbr": 2779,
      "author": {
        "id": 7620
      },
      "writtenOn": "2022-09-13T17:19:57Z",
      "side": 1,
      "message": "For AGG and Skia, the `dest_width` and `dest_height` comes from the parameter `dest_width` and `dest_height` for CFX_ImageStretcher ctor.\nThese widths and height were from a rect calculated from matrix.GetUnitRect().\n\nIf `matrix` is an identity matrix, then matrix.GetUnitRect() will return a rect that\u0027s 1x1.",
      "parentUuid": "7d75fe4d_07e5287a",
      "revId": "78bf67019f606612dee41b9f0d52389bdf383327",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ad53f4b_999d9ded",
        "filename": "core/fxge/skia/fx_skia_device.cpp",
        "patchSetId": 15
      },
      "lineNbr": 2779,
      "author": {
        "id": 5045
      },
      "writtenOn": "2022-09-13T20:41:47Z",
      "side": 1,
      "message": "Thanks for the context. So the next question is, why do this instead of calling `matrix.GetUnitRect()`?",
      "parentUuid": "deff943c_87b005fe",
      "revId": "78bf67019f606612dee41b9f0d52389bdf383327",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6e323ee_3e253e57",
        "filename": "core/fxge/skia/fx_skia_device.cpp",
        "patchSetId": 15
      },
      "lineNbr": 2779,
      "author": {
        "id": 7620
      },
      "writtenOn": "2022-09-14T02:23:51Z",
      "side": 1,
      "message": "The inspiration comes from CFX_ImageTransformer ctor (See [1]) where AGG and SkiaPaths does some simplified calculation to get the `dest_height` and `dest_width`. Besides the simplified calculation, the most generic way to calculate the image rectangle width and height was to do the sqrt operation.\n\nSince SkCanvas::drawImageRect() takes the image rect as it is rather than doing the GetUnitRect().GetClosesetRect() like AGG (which the image rect will look bigger), I think Skia does not have to follow the exact scale up operation as AGG.\n\n[1] https://source.chromium.org/chromium/chromium/src/+/main:third_party/pdfium/core/fxge/dib/cfx_imagetransformer.cpp;drc\u003d3111d4025e2ed2450600445a7207ef22bb03a12f;l\u003d177",
      "parentUuid": "9ad53f4b_999d9ded",
      "revId": "78bf67019f606612dee41b9f0d52389bdf383327",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b"
    }
  ]
}