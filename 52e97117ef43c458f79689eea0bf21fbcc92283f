{
  "comments": [
    {
      "key": {
        "uuid": "d97fbe06_4f6d55be",
        "filename": "core/fxcrt/string_view_template.h",
        "patchSetId": 2
      },
      "lineNbr": 240,
      "author": {
        "id": 5495
      },
      "writtenOn": "2018-05-30T21:17:08Z",
      "side": 1,
      "message": "I suspect this is the only file that needs modification; what happens if your just do\n\n#if !defined(__GNUC__) || __GNUC__ \u003e\u003d 7\nextern template class StringViewTemplate\u003cchar\u003e;\nextern template class StringViewTemplate\u003cwchar_t\u003e;\n#endif\n\nand remove the changes from the other files?",
      "range": {
        "startLine": 240,
        "startChar": 1,
        "endLine": 240,
        "endChar": 7
      },
      "revId": "52e97117ef43c458f79689eea0bf21fbcc92283f",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b21dfcf1_8df33a30",
        "filename": "core/fxcrt/string_view_template.h",
        "patchSetId": 2
      },
      "lineNbr": 240,
      "author": {
        "id": 5495
      },
      "writtenOn": "2018-05-30T21:21:08Z",
      "side": 1,
      "message": "In other words, these two lines prevent the compiler from instantiating template code in every compilation unit that uses it.  Removing them should force this to happen again, with an (inefficient) duplication of these templates in nearly every .o file, which the linker will then dutifully throw out.",
      "parentUuid": "d97fbe06_4f6d55be",
      "range": {
        "startLine": 240,
        "startChar": 1,
        "endLine": 240,
        "endChar": 7
      },
      "revId": "52e97117ef43c458f79689eea0bf21fbcc92283f",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "43c700bc_a7dc627b",
        "filename": "core/fxcrt/string_view_template.h",
        "patchSetId": 2
      },
      "lineNbr": 240,
      "author": {
        "id": 7290
      },
      "writtenOn": "2018-05-31T07:31:44Z",
      "side": 1,
      "message": "That\u0027s the reason for the solution I took. Instead of removing the external declaration always, I only set it for the files where it is not actually explicitely instantiated. This way we still get it one time, and not one per compilation unit.\n\nThe problem is that the constructors extern declaration are masking the non extern declaration because of the gcc bug. If, in the compilation unit that does the explicit declaration we don\u0027t add the extern declaration, and only the explicit declaration, things work as they should:\n- Other users of the template use extern declaration, no additional implementation in their build unit.\n- The build unit that declares explicitely the template, does not get extern declaration, but explicit template declaration, so this is the only point the build unit is instantiated.",
      "parentUuid": "b21dfcf1_8df33a30",
      "range": {
        "startLine": 240,
        "startChar": 1,
        "endLine": 240,
        "endChar": 7
      },
      "revId": "52e97117ef43c458f79689eea0bf21fbcc92283f",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72ff557d_26de0480",
        "filename": "core/fxcrt/string_view_template.h",
        "patchSetId": 2
      },
      "lineNbr": 240,
      "author": {
        "id": 5495
      },
      "writtenOn": "2018-05-31T16:12:21Z",
      "side": 1,
      "message": "Ah.  I\u0027m not sure the additional complexity of that approach is warranted, though.  This is a work-around, eventually it will be removed when GCC 6 is a distant memory.  As such, we want to make it as small and simple as possible in order to get the job done, even if it makes the build less efficient for this one corner case.\n\nThe larger issue is that I\u0027m not certain that there is value in supporting this one compiler version, though. Is there some reason you can\u0027t move to gcc 7, and leave the code unchanged?",
      "parentUuid": "43c700bc_a7dc627b",
      "range": {
        "startLine": 240,
        "startChar": 1,
        "endLine": 240,
        "endChar": 7
      },
      "revId": "52e97117ef43c458f79689eea0bf21fbcc92283f",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    }
  ]
}