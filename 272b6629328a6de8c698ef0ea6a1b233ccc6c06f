{
  "comments": [
    {
      "key": {
        "uuid": "3a81569e_b7d75fc5",
        "filename": "core/fpdfapi/parser/cpdf_cross_ref_table.cpp",
        "patchSetId": 5
      },
      "lineNbr": 115,
      "author": {
        "id": 5045
      },
      "writtenOn": "2018-07-25T18:14:20Z",
      "side": 1,
      "message": "Before this CL, CPDF_Parser::GetLastObjNum() only relies on |objects_info_| to calculate its result. So it is easy to see ShrinkObjectMap() does sufficient bookkeeping with its |objects_info_| updates. e.g. ShrinkObjectMap(5) will always result in GetLastObjNum() returning 4.\n\nNow, CPDF_Parser::GetLastObjNum() relies on CPDF_CrossRefTable::GetSize(), which uses both |objects_info_| and the Size value from the trailer. Yet, ShrinkObjectMap() does not update the trailer. So now there is potential for ShrinkObjectMap() to not have the desired effect. e.g. after calling ShrinkObjectMap(5), GetLastObjNum() can potentially return 5 or higher.\n\nIt would be better if ShrinkObjectMap() had more encapsulation. I have an idea to improve this. I\u0027ll try to make a CL for that soon.",
      "revId": "272b6629328a6de8c698ef0ea6a1b233ccc6c06f",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a4f3362_04833019",
        "filename": "core/fpdfapi/parser/cpdf_cross_ref_table.cpp",
        "patchSetId": 5
      },
      "lineNbr": 115,
      "author": {
        "id": 5045
      },
      "writtenOn": "2018-07-25T19:01:05Z",
      "side": 1,
      "message": "Let me know what you think:\n\nhttps://pdfium-review.googlesource.com/38891\nhttps://pdfium-review.googlesource.com/38892\nhttps://pdfium-review.googlesource.com/38893",
      "parentUuid": "3a81569e_b7d75fc5",
      "revId": "272b6629328a6de8c698ef0ea6a1b233ccc6c06f",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac96bba6_ea68dc7e",
        "filename": "core/fpdfapi/parser/cpdf_cross_ref_table.cpp",
        "patchSetId": 5
      },
      "lineNbr": 115,
      "author": {
        "id": 7160
      },
      "writtenOn": "2018-07-25T19:41:24Z",
      "side": 1,
      "message": "The ShrinkObjectMap needs for drop objects, which is greater or equal to \"Size\" field from trailer.\n\nSee https://cs.chromium.org/chromium/src/third_party/pdfium/core/fpdfapi/parser/cpdf_parser.cpp?rcl\u003d84d3394d88c42b798eedc938e6295ad1bf28ac66\u0026l\u003d689\n\nBut it is can be zero (by original code):\nSee https://cs.chromium.org/chromium/src/third_party/pdfium/core/fpdfapi/parser/cpdf_parser.cpp?rcl\u003d84d3394d88c42b798eedc938e6295ad1bf28ac66\u0026l\u003d310\n\nAs result the size of cross ref table will be std::max(trailer-\u003eGet(\"Size\"), objects_count_in_map);\n\ni.e. the size of cross ref table is object counts within cross ref table + count of skipped free objects.",
      "parentUuid": "3a81569e_b7d75fc5",
      "revId": "272b6629328a6de8c698ef0ea6a1b233ccc6c06f",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    }
  ]
}