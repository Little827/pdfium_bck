{
  "comments": [
    {
      "key": {
        "uuid": "780d0b78_93586661",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 764,
      "author": {
        "id": 5045
      },
      "writtenOn": "2019-11-19T18:22:27Z",
      "side": 1,
      "message": "Typically, the main xref table is at the end of the file. e.g. For a 10 MB PDF, this might read the last 4 KB.",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41b45f7a_b9028e45",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 764,
      "author": {
        "id": 7702
      },
      "writtenOn": "2019-11-21T17:31:04Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "780d0b78_93586661",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3d0a7cbe_61e47263",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 779,
      "author": {
        "id": 5045
      },
      "writtenOn": "2019-11-19T18:22:27Z",
      "side": 1,
      "message": "Whereas the first page\u0027s xref table is likely at the front of the PDF, so this call, for the same hypothetical 10 MB PDF, is at the front. This will request 9.9 MB of data. Can we avoid doing this, and only read what\u0027s needed?",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7a4ef42d_5804f702",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 779,
      "author": {
        "id": 7702
      },
      "writtenOn": "2019-11-21T17:31:04Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "3d0a7cbe_61e47263",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "27f64000_65b57a86",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 779,
      "author": {
        "id": 5045
      },
      "writtenOn": "2019-12-03T20:25:45Z",
      "side": 1,
      "message": "This issue still exists in the latest patch set. Given the scenario I described, this CL currently fixes the issue in terms of correctness, but in terms of performance, it negates most of the benefits of having a linearized PDF by potentially reading in most of it.\n\nPlease take a look at the PDF spec and try to request a more appropriate amount of data here. https://www.adobe.com/content/dam/acom/en/devnet/pdf/pdfs/PDF32000_2008.pdf#page\u003d60",
      "parentUuid": "7a4ef42d_5804f702",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e7ba2753_085b85bf",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 779,
      "author": {
        "id": 7703
      },
      "writtenOn": "2019-12-19T13:17:01Z",
      "side": 1,
      "message": "I agree, the current solution is not efficient for a Linearized PDF. It\u0027s challenging to fetch right amount of data as we don\u0027t know the length of XRefStm from the trailer dictionary. One approach could be to load chunks of data until XRefStm is completely loaded. Let me know your thoughts regarding this.",
      "parentUuid": "27f64000_65b57a86",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ec78480e_234499bb",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 779,
      "author": {
        "id": 5045
      },
      "writtenOn": "2019-12-19T17:48:48Z",
      "side": 1,
      "message": "I\u0027d have to re-read the PDF spec to see if I can give better advice here. Maybe we can do a series of CLs here to make progress:\n\n1) Check in the test, with a TODO to fix the behavior.\n2) Do something like reading just 1 KB of data, or read chunks until the objects load, as a quick fix.\n3) Figure out if there is a better way to read the appropriate amount of data and improve this if we can.",
      "parentUuid": "e7ba2753_085b85bf",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "685f1c18_b2174734",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 779,
      "author": {
        "id": 5045
      },
      "writtenOn": "2020-01-09T23:49:21Z",
      "side": 1,
      "message": "Unfortunately (2) does not work. For linearized_tagged.pdf, the value needs to be 23508 or greater. We still need to do more research into how loading works here, so I\u0027m changing my recommendation to skip (2) and do (1) followed by (3). A CL to just add a test to illustrate a problem can stand up on its own. Shall we do that?",
      "parentUuid": "ec78480e_234499bb",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "740b218e_c7a80662",
        "filename": "core/fpdfapi/parser/cpdf_data_avail.cpp",
        "patchSetId": 8
      },
      "lineNbr": 779,
      "author": {
        "id": 7703
      },
      "writtenOn": "2020-01-10T06:29:35Z",
      "side": 1,
      "message": "To understand it better,\nBy (1) you mean the change in this CL with a TODO. Or you meant that we should just add a test where /StructTreeRoot object is not loaded and remove rest of the change?",
      "parentUuid": "685f1c18_b2174734",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64a07d61_ee366f94",
        "filename": "core/fpdfapi/parser/cpdf_parser.cpp",
        "patchSetId": 8
      },
      "lineNbr": 1075,
      "author": {
        "id": 5045
      },
      "writtenOn": "2019-11-19T18:22:27Z",
      "side": 1,
      "message": "I don\u0027t think we need this method. The underlying problem is LoadLinearizedAllCrossRefV4() is broken. We should fix that, so it reads from /XRefStm correctly, rather than reading from /XRrefStm separately and calling LoadLinearizedAllCrossRefV4() again. I will send a couple CLs for that.",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8bed5e49_c77756b6",
        "filename": "core/fpdfapi/parser/cpdf_parser.cpp",
        "patchSetId": 8
      },
      "lineNbr": 1075,
      "author": {
        "id": 5045
      },
      "writtenOn": "2019-11-19T19:34:33Z",
      "side": 1,
      "message": "CLs to fix up CPDF_Parser so this CL won\u0027t have to change it.\n\nhttps://pdfium-review.googlesource.com/62570\nhttps://pdfium-review.googlesource.com/62551\nhttps://pdfium-review.googlesource.com/62552",
      "parentUuid": "64a07d61_ee366f94",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "58652cb8_f3affb8f",
        "filename": "core/fpdfapi/parser/cpdf_parser.cpp",
        "patchSetId": 8
      },
      "lineNbr": 1075,
      "author": {
        "id": 7702
      },
      "writtenOn": "2019-11-21T17:31:04Z",
      "side": 1,
      "message": "Agreed this cls looks good to me and fix the scenarios.\nShould I abandon this cl? And I will review you cls.Thanks.",
      "parentUuid": "8bed5e49_c77756b6",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bb826918_e4e03ec7",
        "filename": "fpdfsdk/fpdf_save_embeddertest.cpp",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 5045
      },
      "writtenOn": "2019-11-19T18:22:27Z",
      "side": 1,
      "message": "Can you explain what\u0027s happening here?",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4033688a_d393b0a6",
        "filename": "fpdfsdk/fpdf_save_embeddertest.cpp",
        "patchSetId": 8
      },
      "lineNbr": 81,
      "author": {
        "id": 7702
      },
      "writtenOn": "2019-11-21T17:31:04Z",
      "side": 1,
      "message": "I think the same reason you told,requesting more data.",
      "parentUuid": "bb826918_e4e03ec7",
      "revId": "f16c889b10636e51838e1c99998e0d75cfa749f7",
      "serverId": "fca2d64a-0420-3532-b200-12848c95a47b",
      "unresolved": false
    }
  ]
}